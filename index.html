<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <title>Argument</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <nav>
    <span id="myBtn">üíæ</span>
    <div id="myModal">
      <!-- Modal content -->
      <div id="modal-content">
        <span id="closeModal">&times;</span>
        <textarea id="codageArgument"></textarea>
      </div>
    </div>
    <span class="tooltip">‚ìò
      <span class="tooltiptext">
        <ul>
          <li>Pour cr√©er une pr√©misse ou une objection : Double-clic sur l'√©cran.</li>
          <li>Pour cr√©er un lien entre un argument (pr√©misse ou objection) et une id√©e : glisser-d√©poser l'argument sur
            l'id√©e</li>
          <li>Pour naviguer dans l'argumentation : Tabulation</li>
          <li>Pour √©diter un √©l√©ment : Enter ou Double-clic sur l'√©l√©ment</li>
          <li>Pour supprimer un √©l√©ment : Delete</li>
          <li>Souris : vous pouvez d√©placer ou zoomer sur l'argument</li>
          <li>Retour en arri√®re : Cmd+z</li>
          <li>Pour sauvegarder : Clic sur l'ic√¥ne üíæ pour obtenir l'URL de l'argument</li>
        </ul>
      </span>
    </span>
  </nav>
  <div id="element"></div>

  <div id="element-test" style="display:none"></div>

  <script src="reasons.js"></script>
  <script>
    const canvas = document.querySelector('#element')
    const box = canvas.getBoundingClientRect()
    let graphInitial = [{
        id: 'p1',
        text: 'Pr√©misse 1',
        x: box.width * 1.5 / 3,
        y: box.height * 1 / 3 - 125
      },
      {
        id: 'p2',
        text: 'Pr√©misse 2',
        x: box.width * 2 / 3,
        y: box.height * 1 / 3 - 125
      },
      {
        id: 'c1',
        text: 'Conclusion',
        x: box.width / 2 + 150,
        y: box.height * 2 / 3
      },
      {
        from: ['p1', 'p2'],
        to: 'c1'
      },
      //   {id: 'o1', text: 'Objection', x: 440, y: box.height*1/3-20, lineType:'dashed'},
      //   {from: 'o1', to: 'p1'}
    ]



    var codageArgument=localStorage.getItem('codageArgument')
    if (codageArgument) {
      graphInitial=JSON.parse(codageArgument)
    }
    argumentTest = Reasons.mapper('#element-test')

    if(window.location.hash) {
      var newHash = window.location.hash.substring(1);
      hashDecode = decodeURI(newHash); 
      if (JSON.parse(hashDecode)){        
        graphInitial=JSON.parse(hashDecode)
        argumentTestRender = argumentTest.render(graphInitial)
        if (argumentTestRender) {
          if (hashDecode != codageArgument) {
            localStorage.setItem('codageArgument', hashDecode)
            location.reload()
          }
        }
      } else {}
  } else {

  }


    argument = Reasons.mapper('#element')
    argumentRender = argument.render(graphInitial)

    var uri = window.location.href.split("#")[0];

    var autosave = true
    var developerMode=false

    function saveMap() {
      return JSON.stringify(argumentRender["export"]())
    }

    setInterval(function () {
      if (autosave == true) {
        codageArgument = saveMap()
        localStorage.setItem('codageArgument', codageArgument)
      }
    }, 2000);

    var codageArgumentTextArea = document.getElementById("codageArgument")

    

    /* Comportement de la bo√Æte modale */
    // Get the modal
    var modal = document.getElementById("myModal")

    // Get the button that opens the modal
    var btnModal = document.getElementById("myBtn")

    // Get the <span> element that closes the modal
    var closeModal = document.getElementById("closeModal");

    // When the user clicks on the button, open the modal
    btnModal.onclick = function toggleModal() {
      autosave = false
      codageArgumentTextArea.value = saveMap();
      if (developerMode==true) {modal.classList.add("modal-active");} else {

        codageArgument=codageArgumentTextArea.value
      if (JSON.parse(codageArgument)){
        graphInitial=JSON.parse(codageArgument)
        argumentTestRender = argumentTest.render(graphInitial)
        if (argumentTestRender) {
          localStorage.setItem('codageArgument', codageArgument)
          location.replace(uri+'#' + codageArgumentTextArea.value);
        }
      } else {location.reload();}
      autosave = true
      }
    }

    // When the user clicks on (x), close the modal
    closeModal.onclick = function () {
      codageArgument=codageArgumentTextArea.value
      if (JSON.parse(codageArgument)){
        graphInitial=JSON.parse(codageArgument)
        argumentTestRender = argumentTest.render(graphInitial)
        if (argumentTestRender) {
          localStorage.setItem('codageArgument', codageArgument)
          location.replace(uri+'#' + codageArgumentTextArea.value);
        }
      } else {location.reload();}
      autosave = true
      if (developerMode==true) {modal.classList.remove("modal-active")};
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
      if (event.target == modal) {
        autosave = true
        if (developerMode==true) {modal.classList.remove("modal-active")};
      }
    }



  </script>
</body>

</html>

</html>